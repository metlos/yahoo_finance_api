use serde::Deserialize;
use serde_json::Value;
use time::OffsetDateTime;

use crate::{YahooError, OPTIONS_URL};

pub fn compose_options_url(symbol: &str) -> String {
    format!("{}/{}", OPTIONS_URL, symbol)
}

pub fn compose_option_chain_url(symbol: &str, date: OffsetDateTime) -> String {
    format!("{}/{}?date={}", OPTIONS_URL, symbol, date.unix_timestamp())
}

pub fn options_from_response(mut response: Value) -> Result<Options, YahooError> {
    if let Some(Value::Array(mut results)) = response
        .get_mut("optionChain")
        .and_then(|v| v.get_mut("result"))
        .map(|v| v.take())
    {
        if results.is_empty() {
            return Err(YahooError::FetchFailed(
                "expecting an object in results".to_string(),
            ));
        }
        let val = results.remove(0);

        serde_json::from_value(val).map_err(YahooError::DeserializeFailed)
    } else {
        Err(YahooError::FetchFailed(
            "could not find 'optionChain.result' in the response".into(),
        ))
    }
}

pub fn option_chain_from_response(mut response: Value) -> Result<OptionChain, YahooError> {
    if let Some(option_chain) = response
        .get_mut("optionChain")
        .and_then(|v| v.get_mut("result"))
        .and_then(|v| v.as_array_mut())
        .and_then(|v| v.get_mut(0))
        .and_then(|v| v.get_mut("options"))
        .and_then(|v| v.as_array_mut())
        .and_then(|v| v.get_mut(0))
        .map(|v| v.take())
    {
        serde_json::from_value(option_chain).map_err(YahooError::DeserializeFailed)
    } else {
        Err(YahooError::FetchFailed(
            "could not find 'optionChain.result[0].options[0]' in the response".into(),
        ))
    }
}

#[derive(Debug, Clone, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Options {
    pub expiration_dates: Vec<i64>,
    pub strikes: Vec<f64>,
}

#[derive(Debug, Clone, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct OptionChain {
    pub expiration_date: i64,
    pub calls: Vec<OptionContract>,
    pub puts: Vec<OptionContract>,
}

#[derive(Debug, Clone, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct OptionContract {
    pub strike: f64,
    pub currency: String,
    pub last_price: f64,
    pub change: f64,
    pub percent_change: f64,
    pub open_interest: f64,
    pub bid: f64,
    pub ask: f64,
    pub contract_size: String,
    pub expiration: i64,
    pub last_trade_date: i64,
    pub implied_volatility: f64,
    pub in_the_money: bool,
}

#[cfg(test)]
mod test {
    use super::*;

    const OPTIONS_OUTPUT: &str = r#"
{
  "optionChain": {
    "result": [
      {
        "underlyingSymbol": "AAPL",
        "expirationDates": [
          1732838400,
          1733443200,
          1734048000,
          1734652800,
          1735257600,
          1735862400,
          1737072000,
          1740096000,
          1742515200,
          1744848000,
          1750377600,
          1752796800,
          1755216000,
          1758240000,
          1766102400,
          1768521600,
          1781740800,
          1797552000,
          1799971200
        ],
        "strikes": [
          100.0,
          105.0,
          110.0,
          120.0,
          125.0,
          130.0,
          135.0,
          140.0,
          145.0,
          150.0,
          155.0,
          160.0,
          165.0,
          170.0,
          175.0,
          180.0,
          185.0,
          190.0,
          195.0,
          200.0,
          202.5,
          205.0,
          207.5,
          210.0,
          212.5,
          215.0,
          217.5,
          220.0,
          222.5,
          225.0,
          227.5,
          230.0,
          232.5,
          235.0,
          237.5,
          240.0,
          242.5,
          245.0,
          247.5,
          250.0,
          255.0,
          260.0,
          265.0,
          270.0,
          275.0,
          280.0,
          285.0,
          290.0,
          295.0,
          300.0
        ],
        "hasMiniOptions": false,
        "quote": {
          "language": "en-US",
          "region": "US",
          "quoteType": "EQUITY",
          "typeDisp": "Equity",
          "quoteSourceName": "Nasdaq Real Time Price",
          "triggerable": true,
          "customPriceAlertConfidence": "HIGH",
          "exchange": "NMS",
          "shortName": "Apple Inc.",
          "longName": "Apple Inc.",
          "messageBoardId": "finmb_24937",
          "exchangeTimezoneName": "America/New_York",
          "exchangeTimezoneShortName": "EST",
          "gmtOffSetMilliseconds": -18000000,
          "market": "us_market",
          "esgPopulated": false,
          "currency": "USD",
          "marketState": "PRE",
          "regularMarketChangePercent": 0.59075385,
          "regularMarketPrice": 229.87,
          "dividendDate": 1731542400,
          "earningsTimestamp": 1730406600,
          "earningsTimestampStart": 1738270800,
          "earningsTimestampEnd": 1738616400,
          "earningsCallTimestampStart": 1730408400,
          "earningsCallTimestampEnd": 1730408400,
          "isEarningsDateEstimate": true,
          "trailingAnnualDividendRate": 0.98,
          "trailingPE": 37.86985,
          "dividendRate": 1.0,
          "trailingAnnualDividendYield": 0.004288465,
          "dividendYield": 0.44,
          "epsTrailingTwelveMonths": 6.07,
          "epsForward": 8.31,
          "epsCurrentYear": 7.39476,
          "priceEpsCurrentYear": 31.085524,
          "sharesOutstanding": 15115799552,
          "bookValue": 3.767,
          "fiftyDayAverage": 227.734,
          "fiftyDayAverageChange": 2.1360016,
          "fiftyDayAverageChangePercent": 0.009379371,
          "twoHundredDayAverage": 204.85146,
          "twoHundredDayAverageChange": 25.01854,
          "twoHundredDayAverageChangePercent": 0.122130156,
          "marketCap": 3474668650496,
          "forwardPE": 27.661852,
          "priceToBook": 61.022034,
          "sourceInterval": 15,
          "exchangeDataDelayedBy": 0,
          "averageAnalystRating": "1.9 - Buy",
          "tradeable": false,
          "cryptoTradeable": false,
          "hasPrePostMarketData": true,
          "firstTradeDateMilliseconds": 345479400000,
          "priceHint": 2,
          "preMarketChange": 0.5,
          "preMarketChangePercent": 0.21751425,
          "preMarketTime": 1732530343,
          "preMarketPrice": 230.37,
          "regularMarketChange": 1.3499908,
          "regularMarketTime": 1732309201,
          "regularMarketDayHigh": 230.7199,
          "regularMarketDayRange": "228.06 - 230.7199",
          "regularMarketDayLow": 228.06,
          "regularMarketVolume": 36963884,
          "regularMarketPreviousClose": 228.52,
          "bid": 223.5,
          "ask": 229.93,
          "bidSize": 1,
          "askSize": 1,
          "fullExchangeName": "NasdaqGS",
          "financialCurrency": "USD",
          "regularMarketOpen": 228.06,
          "averageDailyVolume3Month": 47904206,
          "averageDailyVolume10Day": 42014670,
          "fiftyTwoWeekLowChange": 65.78999,
          "fiftyTwoWeekLowChangePercent": 0.4009629,
          "fiftyTwoWeekRange": "164.08 - 237.49",
          "fiftyTwoWeekHighChange": -7.6200104,
          "fiftyTwoWeekHighChangePercent": -0.032085605,
          "fiftyTwoWeekLow": 164.08,
          "fiftyTwoWeekHigh": 237.49,
          "fiftyTwoWeekChangePercent": 21.11808,
          "displayName": "Apple",
          "symbol": "AAPL"
        },
        "options": [
          {
            "expirationDate": 1733443200,
            "hasMiniOptions": false,
            "calls": [
              {
                "contractSymbol": "AAPL241206C00100000",
                "strike": 100.0,
                "currency": "USD",
                "lastPrice": 127.55,
                "change": 0.0,
                "percentChange": 0.0,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732122837,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00125000",
                "strike": 125.0,
                "currency": "USD",
                "lastPrice": 105.64,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732299649,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00130000",
                "strike": 130.0,
                "currency": "USD",
                "lastPrice": 100.17,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 3,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732302458,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00135000",
                "strike": 135.0,
                "currency": "USD",
                "lastPrice": 87.35,
                "change": 0.0,
                "percentChange": 0.0,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1730753400,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00140000",
                "strike": 140.0,
                "currency": "USD",
                "lastPrice": 89.0,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731948029,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00145000",
                "strike": 145.0,
                "currency": "USD",
                "lastPrice": 81.75,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732202648,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00150000",
                "strike": 150.0,
                "currency": "USD",
                "lastPrice": 79.12,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 20,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732135177,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00155000",
                "strike": 155.0,
                "currency": "USD",
                "lastPrice": 71.4,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 56,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1730990097,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00160000",
                "strike": 160.0,
                "currency": "USD",
                "lastPrice": 69.58,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732292837,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00165000",
                "strike": 165.0,
                "currency": "USD",
                "lastPrice": 62.09,
                "change": 0.0,
                "percentChange": 0.0,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731941596,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00170000",
                "strike": 170.0,
                "currency": "USD",
                "lastPrice": 60.04,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 10,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732214826,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00175000",
                "strike": 175.0,
                "currency": "USD",
                "lastPrice": 50.12,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 4,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731699189,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00180000",
                "strike": 180.0,
                "currency": "USD",
                "lastPrice": 50.23,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 40,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732286829,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00185000",
                "strike": 185.0,
                "currency": "USD",
                "lastPrice": 45.46,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732042323,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00190000",
                "strike": 190.0,
                "currency": "USD",
                "lastPrice": 39.88,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 182,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732306133,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00195000",
                "strike": 195.0,
                "currency": "USD",
                "lastPrice": 34.77,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 4,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732292196,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00200000",
                "strike": 200.0,
                "currency": "USD",
                "lastPrice": 29.91,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 19,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732306007,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00202500",
                "strike": 202.5,
                "currency": "USD",
                "lastPrice": 24.25,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732120468,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00205000",
                "strike": 205.0,
                "currency": "USD",
                "lastPrice": 24.91,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 66,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732307431,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00207500",
                "strike": 207.5,
                "currency": "USD",
                "lastPrice": 22.15,
                "change": 0.0,
                "percentChange": 0.0,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731958230,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00210000",
                "strike": 210.0,
                "currency": "USD",
                "lastPrice": 20.4,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 23,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308890,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00212500",
                "strike": 212.5,
                "currency": "USD",
                "lastPrice": 17.55,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 21,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732307464,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00215000",
                "strike": 215.0,
                "currency": "USD",
                "lastPrice": 15.55,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 111,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308890,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00217500",
                "strike": 217.5,
                "currency": "USD",
                "lastPrice": 14.0,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 5,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732299162,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00220000",
                "strike": 220.0,
                "currency": "USD",
                "lastPrice": 11.0,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 104,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308899,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00222500",
                "strike": 222.5,
                "currency": "USD",
                "lastPrice": 8.3,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 21,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732307371,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00225000",
                "strike": 225.0,
                "currency": "USD",
                "lastPrice": 6.7,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 4006,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309172,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00227500",
                "strike": 227.5,
                "currency": "USD",
                "lastPrice": 4.96,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 514,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309135,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206C00230000",
                "strike": 230.0,
                "currency": "USD",
                "lastPrice": 3.35,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 3866,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309195,
                "impliedVolatility": 0.000986552734375,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00232500",
                "strike": 232.5,
                "currency": "USD",
                "lastPrice": 2.13,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2277,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309183,
                "impliedVolatility": 0.015634843750000002,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00235000",
                "strike": 235.0,
                "currency": "USD",
                "lastPrice": 1.3,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 8036,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309199,
                "impliedVolatility": 0.0312596875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00237500",
                "strike": 237.5,
                "currency": "USD",
                "lastPrice": 0.75,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2670,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309161,
                "impliedVolatility": 0.0312596875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00240000",
                "strike": 240.0,
                "currency": "USD",
                "lastPrice": 0.4,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1754,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309187,
                "impliedVolatility": 0.062509375,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00242500",
                "strike": 242.5,
                "currency": "USD",
                "lastPrice": 0.22,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1132,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308936,
                "impliedVolatility": 0.062509375,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00245000",
                "strike": 245.0,
                "currency": "USD",
                "lastPrice": 0.12,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 441,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309080,
                "impliedVolatility": 0.062509375,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00247500",
                "strike": 247.5,
                "currency": "USD",
                "lastPrice": 0.06,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 133,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308568,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00250000",
                "strike": 250.0,
                "currency": "USD",
                "lastPrice": 0.05,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 500,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309077,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00255000",
                "strike": 255.0,
                "currency": "USD",
                "lastPrice": 0.02,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 136,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732301763,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00260000",
                "strike": 260.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 79,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732303203,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00265000",
                "strike": 265.0,
                "currency": "USD",
                "lastPrice": 0.04,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 5,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732293550,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00270000",
                "strike": 270.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 23,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732035321,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00275000",
                "strike": 275.0,
                "currency": "USD",
                "lastPrice": 0.02,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732299867,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00280000",
                "strike": 280.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732127548,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00285000",
                "strike": 285.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 5,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731531344,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00290000",
                "strike": 290.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 29,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731336617,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00295000",
                "strike": 295.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731682739,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206C00300000",
                "strike": 300.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732301948,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              }
            ],
            "puts": [
              {
                "contractSymbol": "AAPL241206P00100000",
                "strike": 100.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732215283,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00105000",
                "strike": 105.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 28,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732028212,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00110000",
                "strike": 110.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1227,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731959639,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00120000",
                "strike": 120.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 460,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732048984,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00125000",
                "strike": 125.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 70,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732044989,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00130000",
                "strike": 130.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 3,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731956852,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00135000",
                "strike": 135.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 5,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731956863,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00140000",
                "strike": 140.0,
                "currency": "USD",
                "lastPrice": 0.01,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732199400,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00145000",
                "strike": 145.0,
                "currency": "USD",
                "lastPrice": 0.02,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 18,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731959675,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00150000",
                "strike": 150.0,
                "currency": "USD",
                "lastPrice": 0.02,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 97,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732037310,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00155000",
                "strike": 155.0,
                "currency": "USD",
                "lastPrice": 0.03,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731957976,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00160000",
                "strike": 160.0,
                "currency": "USD",
                "lastPrice": 0.03,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 27,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732048917,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00165000",
                "strike": 165.0,
                "currency": "USD",
                "lastPrice": 0.04,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 31,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732031250,
                "impliedVolatility": 0.500005,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00170000",
                "strike": 170.0,
                "currency": "USD",
                "lastPrice": 0.07,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 7,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732205859,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00175000",
                "strike": 175.0,
                "currency": "USD",
                "lastPrice": 0.05,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 200,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732306021,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00180000",
                "strike": 180.0,
                "currency": "USD",
                "lastPrice": 0.04,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 196,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732306538,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00185000",
                "strike": 185.0,
                "currency": "USD",
                "lastPrice": 0.07,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 3,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732303040,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00190000",
                "strike": 190.0,
                "currency": "USD",
                "lastPrice": 0.08,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 53,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308976,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00195000",
                "strike": 195.0,
                "currency": "USD",
                "lastPrice": 0.1,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 65,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732303348,
                "impliedVolatility": 0.2500075,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00200000",
                "strike": 200.0,
                "currency": "USD",
                "lastPrice": 0.14,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 62,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308897,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00202500",
                "strike": 202.5,
                "currency": "USD",
                "lastPrice": 0.15,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 29,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308968,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00205000",
                "strike": 205.0,
                "currency": "USD",
                "lastPrice": 0.16,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 94,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732307105,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00207500",
                "strike": 207.5,
                "currency": "USD",
                "lastPrice": 0.21,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 121,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308838,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00210000",
                "strike": 210.0,
                "currency": "USD",
                "lastPrice": 0.22,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 861,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308357,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00212500",
                "strike": 212.5,
                "currency": "USD",
                "lastPrice": 0.28,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 73,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732306452,
                "impliedVolatility": 0.12500875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00215000",
                "strike": 215.0,
                "currency": "USD",
                "lastPrice": 0.35,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 370,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308838,
                "impliedVolatility": 0.062509375,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00217500",
                "strike": 217.5,
                "currency": "USD",
                "lastPrice": 0.48,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 200,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308773,
                "impliedVolatility": 0.062509375,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00220000",
                "strike": 220.0,
                "currency": "USD",
                "lastPrice": 0.64,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2247,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309182,
                "impliedVolatility": 0.062509375,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00222500",
                "strike": 222.5,
                "currency": "USD",
                "lastPrice": 0.89,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2233,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309169,
                "impliedVolatility": 0.0312596875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00225000",
                "strike": 225.0,
                "currency": "USD",
                "lastPrice": 1.36,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 3234,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309182,
                "impliedVolatility": 0.0312596875,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00227500",
                "strike": 227.5,
                "currency": "USD",
                "lastPrice": 2.08,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1404,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309190,
                "impliedVolatility": 0.015634843750000002,
                "inTheMoney": false
              },
              {
                "contractSymbol": "AAPL241206P00230000",
                "strike": 230.0,
                "currency": "USD",
                "lastPrice": 2.95,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1888,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309152,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00232500",
                "strike": 232.5,
                "currency": "USD",
                "lastPrice": 4.55,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 204,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732308734,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00235000",
                "strike": 235.0,
                "currency": "USD",
                "lastPrice": 6.43,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 66,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732306195,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00237500",
                "strike": 237.5,
                "currency": "USD",
                "lastPrice": 8.0,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 21,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309068,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00240000",
                "strike": 240.0,
                "currency": "USD",
                "lastPrice": 10.25,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 42,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732301475,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00242500",
                "strike": 242.5,
                "currency": "USD",
                "lastPrice": 12.77,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 18,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732302723,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00245000",
                "strike": 245.0,
                "currency": "USD",
                "lastPrice": 15.45,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 22,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732304783,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00247500",
                "strike": 247.5,
                "currency": "USD",
                "lastPrice": 17.55,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732286399,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00250000",
                "strike": 250.0,
                "currency": "USD",
                "lastPrice": 19.98,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 4,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732309128,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00255000",
                "strike": 255.0,
                "currency": "USD",
                "lastPrice": 25.9,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 2,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1732221454,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00260000",
                "strike": 260.0,
                "currency": "USD",
                "lastPrice": 33.3,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731005162,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00270000",
                "strike": 270.0,
                "currency": "USD",
                "lastPrice": 45.05,
                "change": 0.0,
                "percentChange": 0.0,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731685830,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00275000",
                "strike": 275.0,
                "currency": "USD",
                "lastPrice": 50.1,
                "change": 0.0,
                "percentChange": 0.0,
                "volume": 1,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731685830,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00285000",
                "strike": 285.0,
                "currency": "USD",
                "lastPrice": 59.3,
                "change": 0.0,
                "percentChange": 0.0,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1731531000,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              },
              {
                "contractSymbol": "AAPL241206P00300000",
                "strike": 300.0,
                "currency": "USD",
                "lastPrice": 72.4,
                "change": 0.0,
                "percentChange": 0.0,
                "openInterest": 0,
                "bid": 0.0,
                "ask": 0.0,
                "contractSize": "REGULAR",
                "expiration": 1733443200,
                "lastTradeDate": 1730404217,
                "impliedVolatility": 0.000010000000000000003,
                "inTheMoney": true
              }
            ]
          }
        ]
      }
    ],
    "error": null
  }
}
    "#;
    #[test]
    fn test_options_parsing() {
        let response: Value = serde_json::from_str(OPTIONS_OUTPUT).unwrap();
        let options = options_from_response(response).unwrap();
        assert_eq!(19, options.expiration_dates.len());
        assert_eq!(50, options.strikes.len());
    }

    #[test]
    fn test_option_chain_parsing() {
        let response: Value = serde_json::from_str(OPTIONS_OUTPUT).unwrap();
        let option_chain = option_chain_from_response(response).unwrap();
        assert_eq!(1733443200, option_chain.expiration_date);
        assert_eq!(47, option_chain.calls.len());
        assert_eq!(46, option_chain.puts.len());
    }
}
